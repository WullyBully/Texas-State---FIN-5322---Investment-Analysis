<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brady Bulls">

<title>Python Assignment 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="python_4_efficient_frontier_files/libs/clipboard/clipboard.min.js"></script>
<script src="python_4_efficient_frontier_files/libs/quarto-html/quarto.js"></script>
<script src="python_4_efficient_frontier_files/libs/quarto-html/popper.min.js"></script>
<script src="python_4_efficient_frontier_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="python_4_efficient_frontier_files/libs/quarto-html/anchor.min.js"></script>
<link href="python_4_efficient_frontier_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="python_4_efficient_frontier_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="python_4_efficient_frontier_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="python_4_efficient_frontier_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="python_4_efficient_frontier_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Python Assignment 3</h1>
<p class="subtitle lead">Efficient Frontier</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brady Bulls </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 20 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="part-a" class="level2">
<h2 class="anchored" data-anchor-id="part-a">Part A:</h2>
<section id="step-3-review-and-modify-collab-code" class="level3">
<h3 class="anchored" data-anchor-id="step-3-review-and-modify-collab-code">Step 3: Review and modify collab code</h3>
<div id="cell-3" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math <span class="im">as</span> m</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> scs</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'seaborn-v0_8'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'serif'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings<span class="op">;</span> warnings.simplefilter(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-4" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> portfolio_annualised_performance(weights, mean_returns, cov_matrix):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    returns <span class="op">=</span> np.<span class="bu">sum</span>(mean_returns<span class="op">*</span>weights) <span class="op">*</span> <span class="dv">252</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    std <span class="op">=</span> np.sqrt(np.dot(weights.T, np.dot(cov_matrix, weights))) <span class="op">*</span> np.sqrt(<span class="dv">252</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> std, returns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_portfolio(num_portfolios, mean_returns, cov_matrix, risk_free_rate):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> np.zeros((<span class="dv">3</span>, num_portfolios))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    weights_record <span class="op">=</span> []</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_portfolios):</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> np.random.random(<span class="bu">len</span>(stocks))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">/=</span> np.<span class="bu">sum</span>(weights)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        weights_record.append(weights)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        portfolio_std, portfolio_return <span class="op">=</span> portfolio_annualised_performance(weights, mean_returns, cov_matrix)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        results[<span class="dv">0</span>, i] <span class="op">=</span> portfolio_std_dev</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        results[<span class="dv">1</span>, i] <span class="op">=</span> portfolio_return</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        results[<span class="dv">2</span>, i] <span class="op">=</span> (portfolio_return <span class="op">-</span> risk_free_rate) <span class="op">/</span> portfolio_std</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results, weights_record</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="collecting-sp-500-tickers-from-the-web" class="level4">
<h4 class="anchored" data-anchor-id="collecting-sp-500-tickers-from-the-web">Collecting S&amp;P 500 tickers from the web</h4>
<div id="cell-7" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sp_url <span class="op">=</span> <span class="st">'https://en.wikipedia.org/wiki/List_of_S%26P_500_companies'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sp500_constituents <span class="op">=</span> pd.read_html(sp_url, header<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-8" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>stocks_sp500 <span class="op">=</span> sp500_constituents[<span class="st">'Symbol'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-9" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transpose the oclumn vector to a row vector and covert pandas into a list.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> stocks_sp500.T</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> tickers.values.tolist()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>tickers.remove(<span class="st">'BF.B'</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>tickers.remove(<span class="st">'BRK.B'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>list</code></pre>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>501</code></pre>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> sco</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-13" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neg_sharpe_ratio(weights, mean_returns, cov_matrix, risk_free_rate):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    p_var, p_ret <span class="op">=</span> portfolio_annualised_performance(weights, mean_returns, cov_matrix)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>(p_ret <span class="op">-</span> risk_free_rate) <span class="op">/</span> p_var</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> max_sharpe_ratio(mean_returns, cov_matrix, risk_free_rate):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    num_assets <span class="op">=</span> <span class="bu">len</span>(mean_returns)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> (mean_returns, cov_matrix, risk_free_rate)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    constraints <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="dv">1</span>})</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    bound <span class="op">=</span> (<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> <span class="bu">tuple</span>(bound <span class="cf">for</span> asset <span class="kw">in</span> <span class="bu">range</span>(num_assets))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> sco.minimize(neg_sharpe_ratio, num_assets<span class="op">*</span>[<span class="fl">1.</span><span class="op">/</span>num_assets,], args<span class="op">=</span>args,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                      method<span class="op">=</span><span class="st">'SLSQP'</span>, bounds<span class="op">=</span>bounds, constraints<span class="op">=</span>constraints)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-14" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> portfolio_volatility(weights, mean_returns, cov_matrix):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> portfolio_annualised_performance(weights, mean_returns, cov_matrix)[<span class="dv">0</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_variance(mean_returns, cov_matrix):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    num_assets <span class="op">=</span> <span class="bu">len</span>(mean_returns)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> (mean_returns, cov_matrix)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    constraints <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="dv">1</span>})</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    bound <span class="op">=</span> (<span class="fl">0.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> <span class="bu">tuple</span>(bound <span class="cf">for</span> asset <span class="kw">in</span> <span class="bu">range</span>(num_assets))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> sco.minimize(portfolio_volatility, num_assets<span class="op">*</span>[<span class="fl">1.</span><span class="op">/</span>num_assets,], args<span class="op">=</span>args,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                          method<span class="op">=</span><span class="st">'SLSQP'</span>, bounds<span class="op">=</span>bounds, constraints<span class="op">=</span>constraints)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-15" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> efficient_return(mean_returns, cov_matrix, target):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    num_assets <span class="op">=</span> <span class="bu">len</span>(mean_returns)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> (mean_returns, cov_matrix)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> portfolio_return(weights):</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> portfolio_annualised_performance(weights, mean_returns, cov_matrix)[<span class="dv">1</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    constraints <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: portfolio_return(x) <span class="op">-</span> target},</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                   {<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="dv">1</span>})</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> <span class="bu">tuple</span>((<span class="fl">0.0</span>, <span class="fl">1.0</span>) <span class="cf">for</span> asset <span class="kw">in</span> <span class="bu">range</span>(num_assets))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> sco.minimize(portfolio_volatility, num_assets<span class="op">*</span>[<span class="fl">1.</span><span class="op">/</span>num_assets,], args<span class="op">=</span>args,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                          method<span class="op">=</span><span class="st">'SLSQP'</span>, bounds<span class="op">=</span>bounds, constraints<span class="op">=</span>constraints)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> efficient_frontier(mean_returns, cov_matrix, returns_range):</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    efficients <span class="op">=</span> []</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ret <span class="kw">in</span> returns_range:</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        efficients.append(efficient_return(mean_returns, cov_matrix, ret))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> efficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_ef_with_selected2(mean_returns, cov_matrix, risk_free_rate):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    max_sharpe <span class="op">=</span> max_sharpe_ratio(mean_returns, cov_matrix, risk_free_rate)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    sdp, rp <span class="op">=</span> portfolio_annualised_performance(max_sharpe[<span class="st">'x'</span>], mean_returns, cov_matrix)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    max_sharpe_allocation <span class="op">=</span> pd.DataFrame(max_sharpe.x,index<span class="op">=</span>data.columns,columns<span class="op">=</span>[<span class="st">'allocation'</span>])</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    max_sharpe_allocation.allocation <span class="op">=</span> [<span class="bu">round</span>(i<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>)<span class="cf">for</span> i <span class="kw">in</span> max_sharpe_allocation.allocation]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    max_sharpe_allocation <span class="op">=</span> max_sharpe_allocation.T</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    max_sharpe_allocation</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    min_vol <span class="op">=</span> min_variance(mean_returns, cov_matrix)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sdp_min, rp_min <span class="op">=</span> portfolio_annualised_performance(min_vol[<span class="st">'x'</span>], mean_returns, cov_matrix)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    min_vol_allocation <span class="op">=</span> pd.DataFrame(min_vol.x,index<span class="op">=</span>data.columns,columns<span class="op">=</span>[<span class="st">'allocation'</span>])</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    min_vol_allocation.allocation <span class="op">=</span> [<span class="bu">round</span>(i<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>)<span class="cf">for</span> i <span class="kw">in</span> min_vol_allocation.allocation]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    min_vol_allocation <span class="op">=</span> min_vol_allocation.T</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    an_vol <span class="op">=</span> np.std(returns) <span class="op">*</span> np.sqrt(<span class="dv">252</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    an_rt <span class="op">=</span> mean_returns <span class="op">*</span> <span class="dv">252</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    max_sharpe2 <span class="op">=</span> (rp <span class="op">-</span> risk_free_rate)<span class="op">/</span> sdp</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"-"</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Maximum Sharpe Ratio Portfolio Allocation</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Annualized Return:"</span>, <span class="bu">round</span>(rp,<span class="dv">2</span>))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Annualized Volatility:"</span>, <span class="bu">round</span>(sdp,<span class="dv">2</span>))</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Sharpe ratio ="</span>, max_sharpe)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Sharpe ratio2 ="</span>, <span class="bu">round</span>(max_sharpe2, <span class="dv">4</span>))</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (max_sharpe_allocation)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"-"</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Minimum Volatility Portfolio Allocation</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Annualized Return:"</span>, <span class="bu">round</span>(rp_min,<span class="dv">2</span>))</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Annualized Volatility:"</span>, <span class="bu">round</span>(sdp_min,<span class="dv">2</span>))</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (min_vol_allocation)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"-"</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Individual Stock Returns and Volatility</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, txt <span class="kw">in</span> <span class="bu">enumerate</span>(data.columns):</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span> (txt,<span class="st">":"</span>,<span class="st">"annualized return"</span>,<span class="bu">round</span>(an_rt[i],<span class="dv">2</span>),<span class="st">", annualized volatility:"</span>,<span class="bu">round</span>(an_vol[i],<span class="dv">2</span>))</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"-"</span><span class="op">*</span><span class="dv">80</span>)</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    ax.scatter(an_vol,an_rt,marker<span class="op">=</span><span class="st">'o'</span>,s<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, txt <span class="kw">in</span> <span class="bu">enumerate</span>(data.columns):</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        ax.annotate(txt, (an_vol[i],an_rt[i]), xytext<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">0</span>), textcoords<span class="op">=</span><span class="st">'offset points'</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    ax.scatter(sdp,rp,marker<span class="op">=</span><span class="st">'*'</span>,color<span class="op">=</span><span class="st">'r'</span>,s<span class="op">=</span><span class="dv">500</span>, label<span class="op">=</span><span class="st">'Maximum Sharpe ratio'</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    ax.scatter(sdp_min,rp_min,marker<span class="op">=</span><span class="st">'*'</span>,color<span class="op">=</span><span class="st">'g'</span>,s<span class="op">=</span><span class="dv">500</span>, label<span class="op">=</span><span class="st">'Minimum volatility'</span>)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> np.linspace(rp_min, <span class="fl">0.34</span>, <span class="dv">50</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    efficient_portfolios <span class="op">=</span> efficient_frontier(mean_returns, cov_matrix, target)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    ax.plot([p[<span class="st">'fun'</span>] <span class="cf">for</span> p <span class="kw">in</span> efficient_portfolios], target, linestyle<span class="op">=</span><span class="st">'-.'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'efficient frontier'</span>)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Portfolio Optimization with Individual Stocks'</span>)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'annualized volatility'</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'annualized returns'</span>)</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>    ax.legend(labelspacing<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> max_sharpe_allocation, max_sharpe2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>stocks <span class="op">=</span> random.sample(tickers, <span class="dv">10</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>stocks</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> yf.download(stocks, start<span class="op">=</span><span class="st">"2017-01-01"</span>, end<span class="op">=</span><span class="st">"2023-12-31"</span>, progress<span class="op">=</span><span class="va">True</span>)[<span class="st">'Adj Close'</span>].dropna()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> data.pct_change()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>mean_returns <span class="op">=</span> returns.mean()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>cov_matrix <span class="op">=</span> returns.cov()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>num_portfolios<span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>risk_free_rate <span class="op">=</span> <span class="fl">0.0378</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-18" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>looping <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>max_iterated_SR <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>max_allocation <span class="op">=</span> pd.DataFrame()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(looping):</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    stocks <span class="op">=</span> random.sample(tickers, <span class="dv">10</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I passed the list to yf.download instead of a for loop to try and reduce</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the number of yahoo calls.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> yf.download(stocks, start<span class="op">=</span><span class="st">"2017-01-01"</span>, end<span class="op">=</span><span class="st">"2023-12-31"</span>, progress<span class="op">=</span><span class="va">False</span>)[<span class="st">'Adj Close'</span>].dropna()</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> data.pct_change()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>mean_returns <span class="op">=</span> returns.mean()</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>cov_matrix <span class="op">=</span> returns.cov()</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>num_portfolios <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>risk_free_rate <span class="op">=</span> <span class="fl">0.0378</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>max2, max_SR <span class="op">=</span> display_ef_with_selected2(mean_returns, cov_matrix, risk_free_rate)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> max_SR <span class="op">&gt;=</span> max_iterated_SR:</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    max_iterated_SR <span class="op">=</span> max_SR</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    max_allocation <span class="op">=</span> max2</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The Highest SR=</span><span class="sc">{</span>max_iterated_SR<span class="sc">:.4f}</span><span class="ss">'</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>max_allocation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--------------------------------------------------------------------------------
Maximum Sharpe Ratio Portfolio Allocation

Annualized Return: 0.29
Annualized Volatility: 0.3
Sharpe ratio =  message: Optimization terminated successfully
 success: True
  status: 0
     fun: -0.8437966417302262
       x: [ 2.668e-01  1.807e-02  4.852e-17  0.000e+00  4.975e-01
            4.494e-02  0.000e+00  7.752e-18  1.727e-01  3.944e-17]
     nit: 8
     jac: [-1.245e-01 -1.243e-01  1.290e-01 -1.329e-02 -1.249e-01
           -1.235e-01 -7.518e-02 -1.184e-01 -1.242e-01  1.635e-01]
    nfev: 89
    njev: 8
Sharpe ratio2 = 0.8438


Ticker        ACN  ALGN  AVB  CCI   LRCX  MKTX  PSX  SYK    TJX  ZION
allocation  26.68  1.81  0.0  0.0  49.75  4.49  0.0  0.0  17.27   0.0
--------------------------------------------------------------------------------
Minimum Volatility Portfolio Allocation

Annualized Return: 0.14
Annualized Volatility: 0.2


Ticker        ACN  ALGN    AVB    CCI  LRCX   MKTX   PSX  SYK   TJX  ZION
allocation  16.26   0.0  16.61  23.22   0.0  14.73  7.45  5.4  16.0  0.33
--------------------------------------------------------------------------------
Individual Stock Returns and Volatility

ACN : annualized return 0.2 , annualized volatility: 0.26
ALGN : annualized return 0.28 , annualized volatility: 0.52
AVB : annualized return 0.07 , annualized volatility: 0.26
CCI : annualized return 0.1 , annualized volatility: 0.27
LRCX : annualized return 0.39 , annualized volatility: 0.44
MKTX : annualized return 0.16 , annualized volatility: 0.34
PSX : annualized return 0.16 , annualized volatility: 0.38
SYK : annualized return 0.18 , annualized volatility: 0.28
TJX : annualized return 0.18 , annualized volatility: 0.29
ZION : annualized return 0.1 , annualized volatility: 0.42
--------------------------------------------------------------------------------
The Highest SR=0.8438




CPU times: total: 4min 17s
Wall time: 7min 6s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">ACN</th>
<th data-quarto-table-cell-role="th">ALGN</th>
<th data-quarto-table-cell-role="th">AVB</th>
<th data-quarto-table-cell-role="th">CCI</th>
<th data-quarto-table-cell-role="th">LRCX</th>
<th data-quarto-table-cell-role="th">MKTX</th>
<th data-quarto-table-cell-role="th">PSX</th>
<th data-quarto-table-cell-role="th">SYK</th>
<th data-quarto-table-cell-role="th">TJX</th>
<th data-quarto-table-cell-role="th">ZION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">allocation</td>
<td>26.68</td>
<td>1.81</td>
<td>0.0</td>
<td>0.0</td>
<td>49.75</td>
<td>4.49</td>
<td>0.0</td>
<td>0.0</td>
<td>17.27</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-16-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="step-4-the-hilpisch-code" class="level3">
<h3 class="anchored" data-anchor-id="step-4-the-hilpisch-code">Step 4: The Hilpisch Code</h3>
<div id="cell-21" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math <span class="im">as</span> m</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> scs</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'seaborn-v0_8'</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'serif'</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings<span class="op">;</span> warnings.simplefilter(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normality_test(arr):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Tests or normality distribution of given data set.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Prametters</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">    ==========</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    array: ndarray</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">        object to generate statistics on</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Skew of data set </span><span class="sc">%14.3f</span><span class="st">'</span> <span class="op">%</span> scs.skew(arr))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Skew test p-value </span><span class="sc">%14.3f</span><span class="st">'</span> <span class="op">%</span> scs.skewtest(arr)[<span class="dv">1</span>])</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Kurt of data set </span><span class="sc">%14.3f</span><span class="st">'</span> <span class="op">%</span> scs.kurtosis(arr))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Kurt test p-values </span><span class="sc">%14.3f</span><span class="st">'</span> <span class="op">%</span> scs.kurtosistest(arr)[<span class="dv">1</span>])</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Norm test p-values </span><span class="sc">%14.3f</span><span class="st">'</span> <span class="op">%</span> scs.normaltest(arr)[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="page-break-after: always;"></div>
<div id="cell-24" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_statistcis(array):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">''' prints selected statistics.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Paramaters</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    ==========</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    array: ndarray</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">        object to generate statistics on</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    sta <span class="op">=</span> scs.describe(array)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15s</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'statistic'</span>, <span class="st">'value'</span>))</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="dv">30</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'size'</span>, sta[<span class="dv">0</span>]))</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'max'</span>, sta[<span class="dv">1</span>][<span class="dv">1</span>]))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'mean'</span>, sta[<span class="dv">2</span>]))</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'annual mean'</span>, sta[<span class="dv">2</span>]<span class="op">*</span><span class="dv">252</span>))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'std'</span>, np.sqrt(sta[<span class="dv">3</span>])))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'annual std'</span>, np.sqrt(sta[<span class="dv">3</span>]<span class="op">*</span>np.sqrt(<span class="dv">252</span>))))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'skew'</span>, sta[<span class="dv">4</span>]))</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="sc">%14s</span><span class="st"> </span><span class="sc">%15.5f</span><span class="st">'</span> <span class="op">%</span> (<span class="st">'kurtosis'</span>, sta[<span class="dv">5</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">'SPY'</span>, <span class="st">'GLD'</span>, <span class="st">'AAPL'</span>, <span class="st">'MSFT'</span>]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="op">=</span> pd.DataFrame()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>mydata <span class="op">=</span> yf.download(tickers, start<span class="op">=</span><span class="st">'2010-01-01'</span>, end<span class="op">=</span><span class="st">'2020-06-29'</span>)[<span class="st">'Adj Close'</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>mydata.isna().<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Ticker
AAPL    False
GLD     False
MSFT    False
SPY     False
dtype: bool</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div id="cell-27" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> tickers:</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(t)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    print_statistcis(mydata[t].pct_change().dropna())</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="dv">30</span> <span class="op">*</span> <span class="st">'-'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SPY
     statistic           value
------------------------------
          size      2638.00000
           max         0.09060
          mean         0.00051
   annual mean         0.12814
           std         0.01089
    annual std         0.04340
          skew        -0.60333
      kurtosis        13.90910
------------------------------
GLD
     statistic           value
------------------------------
          size      2638.00000
           max         0.04904
          mean         0.00021
   annual mean         0.05230
           std         0.00995
    annual std         0.03963
          skew        -0.41236
      kurtosis         5.14647
------------------------------
AAPL
     statistic           value
------------------------------
          size      2638.00000
           max         0.11981
          mean         0.00113
   annual mean         0.28601
           std         0.01741
    annual std         0.06936
          skew        -0.14358
      kurtosis         6.35928
------------------------------
MSFT
     statistic           value
------------------------------
          size      2638.00000
           max         0.14217
          mean         0.00092
   annual mean         0.23152
           std         0.01583
    annual std         0.06307
          skew         0.07484
      kurtosis        10.70971
------------------------------</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div id="cell-29" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> mydata</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">SPY</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-04</td>
<td>6.470741</td>
<td>109.800003</td>
<td>23.431591</td>
<td>87.129936</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-05</td>
<td>6.481928</td>
<td>109.699997</td>
<td>23.439150</td>
<td>87.360596</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-06</td>
<td>6.378826</td>
<td>111.510002</td>
<td>23.295313</td>
<td>87.422081</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-07</td>
<td>6.367033</td>
<td>110.820000</td>
<td>23.053051</td>
<td>87.791115</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-08</td>
<td>6.409361</td>
<td>111.370003</td>
<td>23.212042</td>
<td>88.083260</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-22</td>
<td>87.738304</td>
<td>165.089996</td>
<td>193.985809</td>
<td>294.683685</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-23</td>
<td>89.611069</td>
<td>166.479996</td>
<td>195.281815</td>
<td>296.040314</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-24</td>
<td>88.029274</td>
<td>165.899994</td>
<td>191.345444</td>
<td>288.488739</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-25</td>
<td>89.197899</td>
<td>165.800003</td>
<td>193.763351</td>
<td>291.581482</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-26</td>
<td>86.457222</td>
<td>166.539993</td>
<td>189.884979</td>
<td>284.656006</td>
</tr>
</tbody>
</table>

<p>2639 rows  4 columns</p>
</div>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(data <span class="op">/</span> data.iloc[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span>).plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-23-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<div id="cell-32" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>log_returns <span class="op">=</span> np.log(data <span class="op">/</span> data.shift(<span class="dv">1</span>)).dropna()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>log_returns.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">MSFT</th>
<th data-quarto-table-cell-role="th">SPY</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-05</td>
<td>0.001727</td>
<td>-0.000911</td>
<td>0.000323</td>
<td>0.002644</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-06</td>
<td>-0.016034</td>
<td>0.016365</td>
<td>-0.006156</td>
<td>0.000704</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-07</td>
<td>-0.001851</td>
<td>-0.006207</td>
<td>-0.010454</td>
<td>0.004212</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-08</td>
<td>0.006626</td>
<td>0.004951</td>
<td>0.006873</td>
<td>0.003322</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-11</td>
<td>-0.008861</td>
<td>0.013201</td>
<td>-0.012802</td>
<td>0.001396</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>log_returns.hist(bins<span class="op">=</span><span class="dv">50</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([[&lt;Axes: title={'center': 'AAPL'}&gt;,
        &lt;Axes: title={'center': 'GLD'}&gt;],
       [&lt;Axes: title={'center': 'MSFT'}&gt;,
        &lt;Axes: title={'center': 'SPY'}&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-25-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<div id="cell-35" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sym <span class="kw">in</span> tickers:</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Results for symbol </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(sym))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="dv">30</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    log_data <span class="op">=</span> np.array(log_returns[sym].dropna())</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    print_statistcis(log_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results for symbol SPY
------------------------------
     statistic           value
------------------------------
          size      2638.00000
           max         0.08673
          mean         0.00045
   annual mean         0.11309
           std         0.01093
    annual std         0.04356
          skew        -0.86337
      kurtosis        14.87487

Results for symbol GLD
------------------------------
     statistic           value
------------------------------
          size      2638.00000
           max         0.04787
          mean         0.00016
   annual mean         0.03979
           std         0.00997
    annual std         0.03972
          skew        -0.51985
      kurtosis         5.62429

Results for symbol AAPL
------------------------------
     statistic           value
------------------------------
          size      2638.00000
           max         0.11316
          mean         0.00098
   annual mean         0.24764
           std         0.01743
    annual std         0.06946
          skew        -0.36614
      kurtosis         6.80358

Results for symbol MSFT
------------------------------
     statistic           value
------------------------------
          size      2638.00000
           max         0.13293
          mean         0.00079
   annual mean         0.19987
           std         0.01583
    annual std         0.06308
          skew        -0.23301
      kurtosis        11.28599</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div id="cell-37" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>sm.qqplot(log_returns[<span class="st">'SPY'</span>].dropna(), line<span class="op">=</span><span class="st">'s'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'SPY'</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'theoretical quantiles'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'sample quantiles'</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>Text(0, 0.5, 'sample quantiles')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-27-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<section id="rejecting-normality" class="level4">
<h4 class="anchored" data-anchor-id="rejecting-normality">Rejecting Normality</h4>
<div id="cell-40" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sym <span class="kw">in</span> tickers:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Results for symbol </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(sym))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="dv">32</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    log_data <span class="op">=</span> np.array(log_returns[sym].dropna())</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    normality_test(log_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results for symbol SPY
--------------------------------
Skew of data set         -0.863
Skew test p-value          0.000
Kurt of data set         14.875
Kurt test p-values          0.000
Norm test p-values          0.000

Results for symbol GLD
--------------------------------
Skew of data set         -0.520
Skew test p-value          0.000
Kurt of data set          5.624
Kurt test p-values          0.000
Norm test p-values          0.000

Results for symbol AAPL
--------------------------------
Skew of data set         -0.366
Skew test p-value          0.000
Kurt of data set          6.804
Kurt test p-values          0.000
Norm test p-values          0.000

Results for symbol MSFT
--------------------------------
Skew of data set         -0.233
Skew test p-value          0.000
Kurt of data set         11.286
Kurt test p-values          0.000
Norm test p-values          0.000</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="portfolio-optimization" class="level4">
<h4 class="anchored" data-anchor-id="portfolio-optimization">Portfolio Optimization</h4>
<section id="the-data" class="level5">
<h5 class="anchored" data-anchor-id="the-data">The Data</h5>
<div id="cell-44" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>noa <span class="op">=</span> <span class="bu">len</span>(tickers)<span class="op">;</span> <span class="bu">print</span>(noa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> mydata[tickers]<span class="op">;</span> data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">SPY</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-04</td>
<td>87.129936</td>
<td>109.800003</td>
<td>6.470741</td>
<td>23.431591</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-05</td>
<td>87.360596</td>
<td>109.699997</td>
<td>6.481928</td>
<td>23.439150</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-06</td>
<td>87.422081</td>
<td>111.510002</td>
<td>6.378826</td>
<td>23.295313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-07</td>
<td>87.791115</td>
<td>110.820000</td>
<td>6.367033</td>
<td>23.053051</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-08</td>
<td>88.083260</td>
<td>111.370003</td>
<td>6.409361</td>
<td>23.212042</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-22</td>
<td>294.683685</td>
<td>165.089996</td>
<td>87.738304</td>
<td>193.985809</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-23</td>
<td>296.040314</td>
<td>166.479996</td>
<td>89.611069</td>
<td>195.281815</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-24</td>
<td>288.488739</td>
<td>165.899994</td>
<td>88.029274</td>
<td>191.345444</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-25</td>
<td>291.581482</td>
<td>165.800003</td>
<td>89.197899</td>
<td>193.763351</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-26</td>
<td>284.656006</td>
<td>166.539993</td>
<td>86.457222</td>
<td>189.884979</td>
</tr>
</tbody>
</table>

<p>2639 rows  4 columns</p>
</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rets <span class="op">=</span> np.log(data <span class="op">/</span> data.shift(<span class="dv">1</span>))<span class="op">;</span> rets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">SPY</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-04</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-05</td>
<td>0.002644</td>
<td>-0.000911</td>
<td>0.001727</td>
<td>0.000323</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-06</td>
<td>0.000704</td>
<td>0.016365</td>
<td>-0.016034</td>
<td>-0.006156</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2010-01-07</td>
<td>0.004212</td>
<td>-0.006207</td>
<td>-0.001851</td>
<td>-0.010454</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010-01-08</td>
<td>0.003322</td>
<td>0.004951</td>
<td>0.006626</td>
<td>0.006873</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-22</td>
<td>0.006395</td>
<td>0.006441</td>
<td>0.025827</td>
<td>0.027395</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-23</td>
<td>0.004593</td>
<td>0.008384</td>
<td>0.021120</td>
<td>0.006659</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-24</td>
<td>-0.025840</td>
<td>-0.003490</td>
<td>-0.017809</td>
<td>-0.020363</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-06-25</td>
<td>0.010663</td>
<td>-0.000603</td>
<td>0.013188</td>
<td>0.012557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-06-26</td>
<td>-0.024038</td>
<td>0.004453</td>
<td>-0.031208</td>
<td>-0.020219</td>
</tr>
</tbody>
</table>

<p>2639 rows  4 columns</p>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>rets.hist(bins<span class="op">=</span><span class="dv">40</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array([[&lt;Axes: title={'center': 'SPY'}&gt;, &lt;Axes: title={'center': 'GLD'}&gt;],
       [&lt;Axes: title={'center': 'AAPL'}&gt;,
        &lt;Axes: title={'center': 'MSFT'}&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-32-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rets.mean() <span class="op">*</span> <span class="dv">252</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>Ticker
SPY     0.113092
GLD     0.039794
AAPL    0.247640
MSFT    0.199874
dtype: float64</code></pre>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rets.cov() <span class="op">*</span> <span class="dv">252</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">SPY</th>
<th data-quarto-table-cell-role="th">GLD</th>
<th data-quarto-table-cell-role="th">AAPL</th>
<th data-quarto-table-cell-role="th">MSFT</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SPY</td>
<td>0.030126</td>
<td>0.000257</td>
<td>0.031757</td>
<td>0.032632</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLD</td>
<td>0.000257</td>
<td>0.025043</td>
<td>0.001011</td>
<td>-0.000259</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>0.031757</td>
<td>0.001011</td>
<td>0.076588</td>
<td>0.038213</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MSFT</td>
<td>0.032632</td>
<td>-0.000259</td>
<td>0.038213</td>
<td>0.063158</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="the-basic-theory" class="level5">
<h5 class="anchored" data-anchor-id="the-basic-theory">The Basic Theory</h5>
<div id="cell-51" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> np.random.random(noa)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>weights <span class="op">/=</span> np.<span class="bu">sum</span>(weights)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(weights)<span class="op">;</span> <span class="bu">print</span>(noa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.00754126 0.40529023 0.17545843 0.41171008]
4</code></pre>
</div>
</div>
<div id="cell-52" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>array([0.00754126, 0.40529023, 0.17545843, 0.41171008])</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>weights.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>1.0</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(rets.mean() <span class="op">*</span> weights) <span class="op">*</span> <span class="dv">252</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.14272176674830248</code></pre>
</div>
</div>
<div id="cell-55" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>np.dot(weights.T, np.dot(rets.cov() <span class="op">*</span> <span class="dv">252</span>, weights))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.02304539189458869</code></pre>
</div>
</div>
<div id="cell-56" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>m.sqrt(np.dot(weights.T, np.dot(rets.cov() <span class="op">*</span> <span class="dv">252</span>, weights)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0.1518070877613713</code></pre>
</div>
</div>
<div id="cell-57" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> port_ret(weights):</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(rets.mean() <span class="op">*</span> weights) <span class="op">*</span> <span class="dv">252</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> port_vol(weights):</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(np.dot(weights.T, np.dot(rets.cov() <span class="op">*</span> <span class="dv">252</span>, weights)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-58" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>prets <span class="op">=</span> []</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>pvols <span class="op">=</span> []</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span> (<span class="dv">2500</span>):</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> np.random.random(noa)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">/=</span> np.<span class="bu">sum</span>(weights)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    prets.append(port_ret(weights))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    pvols.append(port_vol(weights))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>prets <span class="op">=</span> np.array(prets)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>pvols <span class="op">=</span> np.array(pvols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-59" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(pvols, prets, c<span class="op">=</span>prets <span class="op">/</span> pvols,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="st">'o'</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'expected volatility'</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'expected return'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'Sharpe Ratio'</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="portfolio-optimizations" class="level3">
<h3 class="anchored" data-anchor-id="portfolio-optimizations">Portfolio Optimizations</h3>
<div id="cell-61" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> sco</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_func_sharpe(weights):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>port_ret(weights) <span class="op">/</span> port_vol(weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-63" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>cons <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x)<span class="op">-</span><span class="dv">1</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-64" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>bnds <span class="op">=</span> <span class="bu">tuple</span>((<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(noa))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>eweights <span class="op">=</span> np.array(noa <span class="op">*</span> [<span class="fl">1.</span> <span class="op">/</span> noa,])</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>eweights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>array([0.25, 0.25, 0.25, 0.25])</code></pre>
</div>
</div>
<div id="cell-66" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>min_func_sharpe(weights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>-0.8213218692625033</code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>opts <span class="op">=</span> sco.minimize(min_func_sharpe, eweights,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">'SLSQP'</span>, bounds<span class="op">=</span>bnds,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                    constraints<span class="op">=</span>cons)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>port_ret(opts[<span class="st">'x'</span>]) <span class="op">/</span> port_vol(opts[<span class="st">'x'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: total: 15.6 ms
Wall time: 21 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>0.995018725618054</code></pre>
</div>
</div>
<section id="find-the-highest-sr-possible-from-selecting-ten-assets-from-sp-500-firms-and-optimizing-the-sr" class="level5">
<h5 class="anchored" data-anchor-id="find-the-highest-sr-possible-from-selecting-ten-assets-from-sp-500-firms-and-optimizing-the-sr">Find the highest SR possible from selecting ten assets from S&amp;P 500 firms and optimizing the SR</h5>
<div id="cell-69" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sp_url <span class="op">=</span> <span class="st">'https://en.wikipedia.org/wiki/List_of_S%26P_500_companies'</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>sp500_constituents <span class="op">=</span> pd.read_html(sp_url, header<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>stocks_sp500 <span class="op">=</span> sp500_constituents[<span class="st">'Symbol'</span>]</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> stocks_sp500.T</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> tickers.values.tolist()</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>tickers.remove(<span class="st">'BF.B'</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>tickers.remove(<span class="st">'BRK.B'</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>501</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize <span class="im">as</span> sco</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>noa <span class="op">=</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-71" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>loops <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>max_iterated_SR <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>max_allocation <span class="op">=</span> <span class="va">None</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>best_stocks <span class="op">=</span> <span class="va">None</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(loops):</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    stocks <span class="op">=</span> random.sample(tickers, <span class="dv">10</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> yf.download(stocks, start<span class="op">=</span><span class="st">"2017-01-01"</span>, end<span class="op">=</span><span class="st">"2023-12-31"</span>, progress<span class="op">=</span><span class="va">False</span>)[<span class="st">'Adj Close'</span>].dropna()</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    rets <span class="op">=</span> np.log(data <span class="op">/</span> data.shift(<span class="dv">1</span>))</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> min_func_sharpe(weights):</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span>port_ret(weights) <span class="op">/</span> port_vol(weights)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    cons <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x:  np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="dv">1</span>})</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    bnds <span class="op">=</span> <span class="bu">tuple</span>((<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(noa))</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    eweights <span class="op">=</span> np.array(noa <span class="op">*</span> [<span class="fl">1.</span> <span class="op">/</span> noa,])</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    min_func_sharpe(eweights)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    opts <span class="op">=</span> sco.minimize(min_func_sharpe, eweights,</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>                        method<span class="op">=</span><span class="st">'SLSQP'</span>, bounds<span class="op">=</span>bnds,</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>                        constraints<span class="op">=</span>cons)</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    current_SR <span class="op">=</span> <span class="op">-</span>opts.fun</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> current_SR <span class="op">&gt;</span> max_iterated_SR:</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>        max_iterated_SR <span class="op">=</span> current_SR</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>        max_allocation <span class="op">=</span> opts.x</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>        best_stocks <span class="op">=</span> stocks</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Results'</span>)</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">30</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Highest Sharpe Ratio: </span><span class="sc">{</span>max_iterated_SR<span class="sc">:.4f}</span><span class="ss">'</span>)</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">30</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Optimal Allocation:'</span>, max_allocation)</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">30</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Selected Stocks: </span><span class="sc">{</span>best_stocks<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Results
------------------------------
Highest Sharpe Ratio: 7.5334
------------------------------
Optimal Allocation: [0.00000000e+00 7.11056901e-15 1.39175443e-01 8.25501539e-15
 1.38723680e-01 3.35536321e-01 3.86564556e-01 5.21155907e-15
 0.00000000e+00 0.00000000e+00]
------------------------------
Selected Stocks: ['NRG', 'DRI', 'SBUX', 'CAH', 'RSG', 'FOX', 'CSCO', 'LEN', 'TEL', 'VLTO']
CPU times: total: 10min 5s
Wall time: 15min 46s</code></pre>
</div>
</div>
</section>
<section id="just-for-fun-the-optimal-sp-500-portfolio" class="level5">
<h5 class="anchored" data-anchor-id="just-for-fun-the-optimal-sp-500-portfolio">Just for fun, the optimal S&amp;P 500 Portfolio</h5>
<div id="cell-73" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>noa <span class="op">=</span> <span class="bu">len</span>(tickers)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>cons <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x)<span class="op">-</span><span class="dv">1</span>})</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>bnds <span class="op">=</span> <span class="bu">tuple</span>((<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(noa))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>eweights <span class="op">=</span> np.array(noa <span class="op">*</span> [<span class="fl">1.</span> <span class="op">/</span> noa,])</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co">#min_func_sharpe(weights)</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> yf.download(tickers, start<span class="op">=</span><span class="st">"2017-01-01"</span>, end<span class="op">=</span><span class="st">"2023-12-31"</span>, progress<span class="op">=</span><span class="va">True</span>)[<span class="st">'Adj Close'</span>].dropna()</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>rets <span class="op">=</span> np.log(data <span class="op">/</span> data.shift(<span class="dv">1</span>))</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> min_func_sharpe(weights):</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>port_ret(weights) <span class="op">/</span> port_vol(weights)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>cons <span class="op">=</span> ({<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> x:  np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="dv">1</span>})</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>bnds <span class="op">=</span> <span class="bu">tuple</span>((<span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(noa))</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>eweights <span class="op">=</span> np.array(noa <span class="op">*</span> [<span class="fl">1.</span> <span class="op">/</span> noa,])</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>min_func_sharpe(eweights)</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>opts <span class="op">=</span> sco.minimize(min_func_sharpe, eweights,</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>                    method<span class="op">=</span><span class="st">'SLSQP'</span>, bounds<span class="op">=</span>bnds,</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>                    constraints<span class="op">=</span>cons)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>optimal_weights_df <span class="op">=</span> pd.DataFrame(opts.x, index<span class="op">=</span>data.columns, columns<span class="op">=</span>[<span class="st">'Optimal Weights'</span>])</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(optimal_weights_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Optimal Weights
Ticker                 
A          2.851806e-11
AAL        4.519820e-11
AAPL       1.956665e-11
ABBV       2.926920e-11
ABNB       1.377566e-10
...                 ...
YUM        4.485146e-12
ZBH        9.162573e-12
ZBRA       1.815472e-11
ZION       1.511795e-10
ZTS        1.559570e-11

[501 rows x 1 columns]
CPU times: total: 12min 52s
Wall time: 12min 55s</code></pre>
</div>
</div>
<div id="cell-74" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>optimal_weights_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Optimal Weights</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">A</td>
<td>2.851806e-11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AAL</td>
<td>4.519820e-11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AAPL</td>
<td>1.956665e-11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ABBV</td>
<td>2.926920e-11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ABNB</td>
<td>1.377566e-10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">YUM</td>
<td>4.485146e-12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ZBH</td>
<td>9.162573e-12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZBRA</td>
<td>1.815472e-11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ZION</td>
<td>1.511795e-10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZTS</td>
<td>1.559570e-11</td>
</tr>
</tbody>
</table>

<p>501 rows  1 columns</p>
</div>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>reset <span class="op">-</span>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the datatable for the optimal SP 500 list, it seems that there are some computational limitations, as after a certain point, the optimal weights are just zeros.</p>
</section>
</section>
</section>
<section id="part-b" class="level2">
<h2 class="anchored" data-anchor-id="part-b">Part B</h2>
<section id="excersise-2.1-data-manipulation" class="level3">
<h3 class="anchored" data-anchor-id="excersise-2.1-data-manipulation">Excersise 2.1: Data Manipulation</h3>
<div id="cell-79" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/datasets/london-life-expectancy/master/data/female-life-expectancy.csv'</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'female-life-expectancy.csv'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span>.write(response.content)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"File succesfully downloaded."</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed to download the file. Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File succesfully downloaded.</code></pre>
</div>
</div>
<div id="cell-80" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> pd.read_csv(<span class="st">'female-life-expectancy.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-81" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>le_female <span class="op">=</span> raw_data</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>le_female.rename(columns<span class="op">=</span>{<span class="st">'Value'</span>: <span class="st">'Life Expect'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-82" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> le_female[<span class="st">'Life Expect'</span>].mean()</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> le_female[<span class="st">'Life Expect'</span>].median()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>descrip <span class="op">=</span> le_female[<span class="st">'Life Expect'</span>].describe()</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'</span><span class="ch">\n</span><span class="st">Female Life Expectancy Statistics'</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">35</span> <span class="op">*</span> <span class="st">'-'</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Mean: </span><span class="sc">{</span>mean<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Median: </span><span class="sc">{</span>median<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Descriptive Stats: </span><span class="sc">{</span>descrip<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> raw_data, le_female</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Female Life Expectancy Statistics
-----------------------------------
Mean: 81.280
Median: 81.100
Descriptive Stats: count    988.000000
mean      81.280104
std        1.885620
min       77.400000
25%       79.900000
50%       81.100000
75%       82.650000
max       86.700000
Name: Life Expect, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="excersise-2.2-data-import-and-export" class="level3">
<h3 class="anchored" data-anchor-id="excersise-2.2-data-import-and-export">Excersise 2.2: Data import and export</h3>
<div id="cell-84" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/datasets/population-reference-bureau/master/data/us/fertility/data/us-fertility.csv'</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">'us-fertility.csv'</span>, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span>.write(response.content)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"File succesfully downloaded."</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> <span class="bu">file</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Failed to download the file. Status code: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File succesfully downloaded.</code></pre>
</div>
</div>
<div id="cell-85" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>fertilityUS <span class="op">=</span> pd.read_csv(<span class="st">'us-fertility.csv'</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>fertilityUS.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 936 entries, 0 to 935
Data columns (total 4 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   Type       936 non-null    object 
 1   TimeFrame  936 non-null    int64  
 2   Data       936 non-null    float64
 3   NameFIPS   936 non-null    object 
dtypes: float64(1), int64(1), object(2)
memory usage: 29.4+ KB</code></pre>
</div>
</div>
<div id="cell-86" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>fertilityUS[<span class="st">'NameFIPS'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>NameFIPS
Alabama 01                 18
Alaska 02                  18
Nevada 32                  18
New Hampshire 33           18
New Jersey 34              18
New Mexico 35              18
New York 36                18
North Carolina 37          18
North Dakota 38            18
Ohio 39                    18
Oklahoma 40                18
Oregon 41                  18
Pennsylvania 42            18
Rhode Island 44            18
South Carolina 45          18
South Dakota 46            18
Tennessee 47               18
Texas 48                   18
Utah 49                    18
Vermont 50                 18
Virginia 51                18
Washington 53              18
West Virginia 54           18
Wisconsin 55               18
Wyoming 56                 18
Nebraska 31                18
Montana 30                 18
Missouri 29                18
Idaho 16                   18
Arizona 04                 18
Arkansas 05                18
California 06              18
Colorado 08                18
Connecticut 09             18
Delaware 10                18
District of Columbia 11    18
Florida 12                 18
Georgia 13                 18
Hawaii 15                  18
Illinois 17                18
Mississippi 28             18
Indiana 18                 18
Iowa 19                    18
Kansas 20                  18
Kentucky 21                18
Louisiana 22               18
Maine 23                   18
Maryland 24                18
Massachusetts 25           18
Michigan 26                18
Minnesota 27               18
United States US           18
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-87" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>grouped_states <span class="op">=</span> fertilityUS.groupby(<span class="st">'TimeFrame'</span>)[<span class="st">'Data'</span>].mean()</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>grouped_states</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>TimeFrame
2000    2.088654
2001    2.075577
2002    1.992885
2003    2.022308
2004    2.027115
2005    2.030385
2006    2.092500
2007    2.116731
2008    2.085385
2009    2.004808
2010    1.943462
2011    1.910577
2012    1.896923
2013    1.877500
2014    1.880962
2015    1.866538
2016    1.841538
2017    1.788077
Name: Data, dtype: float64</code></pre>
</div>
</div>
<div id="cell-88" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>grouped_year <span class="op">=</span> fertilityUS.groupby(<span class="st">'NameFIPS'</span>)[<span class="st">'Data'</span>].mean()</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>grouped_year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>NameFIPS
Alabama 01                 1.907778
Alaska 02                  2.309444
Arizona 04                 2.204444
Arkansas 05                2.046667
California 06              2.007778
Colorado 08                1.983333
Connecticut 09             1.786667
Delaware 10                1.936111
District of Columbia 11    1.665556
Florida 12                 1.932222
Georgia 13                 2.036111
Hawaii 15                  2.163333
Idaho 16                   2.255000
Illinois 17                1.945000
Indiana 18                 2.006111
Iowa 19                    2.023333
Kansas 20                  2.130000
Kentucky 21                1.970556
Louisiana 22               1.992778
Maine 23                   1.691667
Maryland 24                1.910000
Massachusetts 25           1.683333
Michigan 26                1.872778
Minnesota 27               2.003333
Mississippi 28             2.011111
Missouri 29                1.954444
Montana 30                 1.985000
Nebraska 31                2.188333
Nevada 32                  2.122222
New Hampshire 33           1.670556
New Jersey 34              1.953889
New Mexico 35              2.093333
New York 36                1.827778
North Carolina 37          1.983889
North Dakota 38            2.057778
Ohio 39                    1.927222
Oklahoma 40                2.096667
Oregon 41                  1.837778
Pennsylvania 42            1.824444
Rhode Island 44            1.670000
South Carolina 45          1.915556
South Dakota 46            2.267222
Tennessee 47               1.942222
Texas 48                   2.237778
United States US           1.967778
Utah 49                    2.471667
Vermont 50                 1.622222
Virginia 51                1.909444
Washington 53              1.906111
West Virginia 54           1.808889
Wisconsin 55               1.907778
Wyoming 56                 2.052222
Name: Data, dtype: float64</code></pre>
</div>
</div>
<div id="cell-89" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> [<span class="st">'Georgia 13'</span>, <span class="st">'South Carolina 45'</span>, <span class="st">'Florida 12'</span>]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>southdata <span class="op">=</span> fertilityUS.loc[fertilityUS[<span class="st">'NameFIPS'</span>].isin(states)]</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>southdata.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">TimeFrame</th>
<th data-quarto-table-cell-role="th">Data</th>
<th data-quarto-table-cell-role="th">NameFIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>State</td>
<td>2000</td>
<td>2.16</td>
<td>Florida 12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">163</td>
<td>State</td>
<td>2001</td>
<td>2.17</td>
<td>Florida 12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">164</td>
<td>State</td>
<td>2002</td>
<td>2.00</td>
<td>Florida 12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">165</td>
<td>State</td>
<td>2003</td>
<td>2.01</td>
<td>Florida 12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">166</td>
<td>State</td>
<td>2004</td>
<td>2.02</td>
<td>Florida 12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-90" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>southsubset <span class="op">=</span> southdata.iloc[<span class="dv">0</span>:<span class="dv">20</span>, <span class="dv">3</span>:<span class="dv">4</span>]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>southsubset.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 20 entries, 162 to 181
Data columns (total 1 columns):
 #   Column    Non-Null Count  Dtype 
---  ------    --------------  ----- 
 0   NameFIPS  20 non-null     object
dtypes: object(1)
memory usage: 320.0+ bytes</code></pre>
</div>
</div>
<div id="cell-91" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>reset <span class="op">-</span>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="excersise-2.3-hypothesis-testing-with-fertility-data" class="level3">
<h3 class="anchored" data-anchor-id="excersise-2.3-hypothesis-testing-with-fertility-data">Excersise 2.3: Hypothesis Testing with Fertility Data</h3>
<div id="cell-93" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-94" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/datasets/population-reference-bureau/master/data/us/fertility/data/us-fertility.csv"</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>fertility <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>fertility</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Type</th>
<th data-quarto-table-cell-role="th">TimeFrame</th>
<th data-quarto-table-cell-role="th">Data</th>
<th data-quarto-table-cell-role="th">NameFIPS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>State</td>
<td>2000</td>
<td>2.02</td>
<td>Alabama 01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>State</td>
<td>2001</td>
<td>1.94</td>
<td>Alabama 01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>State</td>
<td>2002</td>
<td>1.88</td>
<td>Alabama 01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>State</td>
<td>2003</td>
<td>1.92</td>
<td>Alabama 01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>State</td>
<td>2004</td>
<td>1.91</td>
<td>Alabama 01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">931</td>
<td>Country</td>
<td>2013</td>
<td>1.86</td>
<td>United States US</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">932</td>
<td>Country</td>
<td>2014</td>
<td>1.86</td>
<td>United States US</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">933</td>
<td>Country</td>
<td>2015</td>
<td>1.84</td>
<td>United States US</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">934</td>
<td>Country</td>
<td>2016</td>
<td>1.82</td>
<td>United States US</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">935</td>
<td>Country</td>
<td>2017</td>
<td>1.77</td>
<td>United States US</td>
</tr>
</tbody>
</table>

<p>936 rows  4 columns</p>
</div>
</div>
</div>
<div id="cell-95" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>null <span class="op">=</span> <span class="fl">2.1</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>fertility_2017 <span class="op">=</span> fertility[fertility[<span class="st">'TimeFrame'</span>] <span class="op">==</span> <span class="dv">2017</span>][<span class="st">'Data'</span>]</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> sm.stats.ztest(fertility_2017, value <span class="op">=</span> null, alternative <span class="op">=</span> <span class="st">"smaller"</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> {<span class="st">'Z'</span>: [test[<span class="dv">0</span>]], <span class="st">'P-Value'</span>: [test[<span class="dv">1</span>]]}</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>d)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"T-statistic: {t_statistic}")</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"P-value: {p_value}")</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Degrees of Freedom: {degrees_of_freedom}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Z</th>
<th data-quarto-table-cell-role="th">P-Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-13.72876</td>
<td>3.414602e-43</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="excersise-2.4-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="excersise-2.4-linear-regression">Excersise 2.4: Linear Regression</h3>
<div id="cell-97" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>tips <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/mwaskom/seaborn-data/master/tips.csv'</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>tips.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">total_bill</th>
<th data-quarto-table-cell-role="th">tip</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">smoker</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>16.99</td>
<td>1.01</td>
<td>Female</td>
<td>No</td>
<td>Sun</td>
<td>Dinner</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10.34</td>
<td>1.66</td>
<td>Male</td>
<td>No</td>
<td>Sun</td>
<td>Dinner</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>21.01</td>
<td>3.50</td>
<td>Male</td>
<td>No</td>
<td>Sun</td>
<td>Dinner</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>23.68</td>
<td>3.31</td>
<td>Male</td>
<td>No</td>
<td>Sun</td>
<td>Dinner</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24.59</td>
<td>3.61</td>
<td>Female</td>
<td>No</td>
<td>Sun</td>
<td>Dinner</td>
<td>4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-98" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>tipsN <span class="op">=</span> pd.get_dummies(tips, columns<span class="op">=</span>[<span class="st">'sex'</span>,<span class="st">'smoker'</span>], dtype<span class="op">=</span><span class="bu">float</span>) <span class="co"># this converts the categorical variables into dummies.</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>tipsN.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">total_bill</th>
<th data-quarto-table-cell-role="th">tip</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">sex_Female</th>
<th data-quarto-table-cell-role="th">sex_Male</th>
<th data-quarto-table-cell-role="th">smoker_No</th>
<th data-quarto-table-cell-role="th">smoker_Yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>16.99</td>
<td>1.01</td>
<td>Sun</td>
<td>Dinner</td>
<td>2</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10.34</td>
<td>1.66</td>
<td>Sun</td>
<td>Dinner</td>
<td>3</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>21.01</td>
<td>3.50</td>
<td>Sun</td>
<td>Dinner</td>
<td>3</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>23.68</td>
<td>3.31</td>
<td>Sun</td>
<td>Dinner</td>
<td>2</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>24.59</td>
<td>3.61</td>
<td>Sun</td>
<td>Dinner</td>
<td>4</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-99" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>tipsNew <span class="op">=</span> tipsN.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-100" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>XVars <span class="op">=</span> tipsNew[[<span class="st">'sex_Male'</span>, <span class="st">'smoker_Yes'</span>, <span class="st">'total_bill'</span>]]</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> tipsNew[<span class="st">'tip'</span>]</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>XVars <span class="op">=</span> sm.add_constant(XVars)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(Y, XVars).fit()</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> model.predict(XVars)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>print_model <span class="op">=</span> model.summary()</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(print_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    tip   R-squared:                       0.459
Model:                            OLS   Adj. R-squared:                  0.453
Method:                 Least Squares   F-statistic:                     67.99
Date:                Tue, 20 Feb 2024   Prob (F-statistic):           7.39e-32
Time:                        11:56:29   Log-Likelihood:                -349.90
No. Observations:                 244   AIC:                             707.8
Df Residuals:                     240   BIC:                             721.8
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.9770      0.178      5.484      0.000       0.626       1.328
sex_Male      -0.0281      0.138     -0.203      0.839      -0.300       0.244
smoker_Yes    -0.1492      0.135     -1.102      0.272      -0.416       0.118
total_bill     0.1059      0.007     14.158      0.000       0.091       0.121
==============================================================================
Omnibus:                       23.998   Durbin-Watson:                   2.148
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               44.857
Skew:                           0.528   Prob(JB):                     1.82e-10
Kurtosis:                       4.815   Cond. No.                         64.6
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</section>
<section id="exercise-2.5-basic-plots" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.5-basic-plots">Exercise 2.5: Basic Plots</h3>
<div id="cell-102" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> s</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>s.get_dataset_names()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>['anagrams',
 'anscombe',
 'attention',
 'brain_networks',
 'car_crashes',
 'diamonds',
 'dots',
 'dowjones',
 'exercise',
 'flights',
 'fmri',
 'geyser',
 'glue',
 'healthexp',
 'iris',
 'mpg',
 'penguins',
 'planets',
 'seaice',
 'taxis',
 'tips',
 'titanic']</code></pre>
</div>
</div>
<div id="cell-103" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>s.load_dataset(<span class="st">'flights'</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">passengers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1949</td>
<td>Jan</td>
<td>112</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1949</td>
<td>Feb</td>
<td>118</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1949</td>
<td>Mar</td>
<td>132</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1949</td>
<td>Apr</td>
<td>129</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1949</td>
<td>May</td>
<td>121</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-104" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>flight_data <span class="op">=</span> s.load_dataset(<span class="st">'flights'</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(flight_data[<span class="st">'year'</span>], flight_data[<span class="st">'passengers'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-2.6-distribution-plot" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.6-distribution-plot">Exercise 2.6: Distribution Plot</h3>
<div id="cell-106" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="op">=</span> s.load_dataset(<span class="st">'mpg'</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>mpg.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">model_year</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>18.0</td>
<td>8</td>
<td>307.0</td>
<td>130.0</td>
<td>3504</td>
<td>12.0</td>
<td>70</td>
<td>usa</td>
<td>chevrolet chevelle malibu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>15.0</td>
<td>8</td>
<td>350.0</td>
<td>165.0</td>
<td>3693</td>
<td>11.5</td>
<td>70</td>
<td>usa</td>
<td>buick skylark 320</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>18.0</td>
<td>8</td>
<td>318.0</td>
<td>150.0</td>
<td>3436</td>
<td>11.0</td>
<td>70</td>
<td>usa</td>
<td>plymouth satellite</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>16.0</td>
<td>8</td>
<td>304.0</td>
<td>150.0</td>
<td>3433</td>
<td>12.0</td>
<td>70</td>
<td>usa</td>
<td>amc rebel sst</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>17.0</td>
<td>8</td>
<td>302.0</td>
<td>140.0</td>
<td>3449</td>
<td>10.5</td>
<td>70</td>
<td>usa</td>
<td>ford torino</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-107" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>cylinders <span class="op">=</span> [<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">5</span>]</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> cylinders:</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> mpg[mpg[<span class="st">'cylinders'</span>] <span class="op">==</span> c]</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use line_kws to set the linewidth for the KDE plot</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    s.distplot(subset[<span class="st">'mpg'</span>], hist <span class="op">=</span> <span class="va">False</span>, kde<span class="op">=</span><span class="va">True</span>, kde_kws<span class="op">=</span>{<span class="st">'linewidth'</span>:<span class="dv">3</span>}, label <span class="op">=</span> c)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Miles per Gallon (MPG)'</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>plt.legend(cylinders)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-80-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-2.7-box-plot" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2.7-box-plot">Exercise 2.7: Box Plot</h3>
<div id="cell-109" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>mpg.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mpg</th>
<th data-quarto-table-cell-role="th">cylinders</th>
<th data-quarto-table-cell-role="th">displacement</th>
<th data-quarto-table-cell-role="th">horsepower</th>
<th data-quarto-table-cell-role="th">weight</th>
<th data-quarto-table-cell-role="th">acceleration</th>
<th data-quarto-table-cell-role="th">model_year</th>
<th data-quarto-table-cell-role="th">origin</th>
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>18.0</td>
<td>8</td>
<td>307.0</td>
<td>130.0</td>
<td>3504</td>
<td>12.0</td>
<td>70</td>
<td>usa</td>
<td>chevrolet chevelle malibu</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>15.0</td>
<td>8</td>
<td>350.0</td>
<td>165.0</td>
<td>3693</td>
<td>11.5</td>
<td>70</td>
<td>usa</td>
<td>buick skylark 320</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>18.0</td>
<td>8</td>
<td>318.0</td>
<td>150.0</td>
<td>3436</td>
<td>11.0</td>
<td>70</td>
<td>usa</td>
<td>plymouth satellite</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>16.0</td>
<td>8</td>
<td>304.0</td>
<td>150.0</td>
<td>3433</td>
<td>12.0</td>
<td>70</td>
<td>usa</td>
<td>amc rebel sst</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>17.0</td>
<td>8</td>
<td>302.0</td>
<td>140.0</td>
<td>3449</td>
<td>10.5</td>
<td>70</td>
<td>usa</td>
<td>ford torino</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-110" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>s.boxplot(x<span class="op">=</span><span class="st">'origin'</span>, y<span class="op">=</span><span class="st">'horsepower'</span>, data <span class="op">=</span> mpg)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Country of Origin'</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Horse Power'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>Text(0, 0.5, 'Horse Power')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-82-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-111" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>s.boxplot(x<span class="op">=</span><span class="st">'origin'</span>, y<span class="op">=</span><span class="st">'mpg'</span>, data <span class="op">=</span> mpg)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Country of Origin'</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Miles per Gallon'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>Text(0, 0.5, 'Miles per Gallon')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_4_efficient_frontier_files/figure-html/cell-83-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>